
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Chapter 10 Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="11-Mobile_friendly_web_apps.html" />
    
    
    <link rel="prev" href="09-Heatmaps.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="01-Introduction.html">
            
                <a href="01-Introduction.html">
            
                    
                    Chapter 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="02-First_Leaflet_Map.html">
            
                <a href="02-First_Leaflet_Map.html">
            
                    
                    Chapter 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="03-Add_ons.html">
            
                <a href="03-Add_ons.html">
            
                    
                    Chapter 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="04-Embedding_Leaflet_Map_to_an_External_Website.html">
            
                <a href="04-Embedding_Leaflet_Map_to_an_External_Website.html">
            
                    
                    Chapter 4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="05-Using_geojson_files_in_Leaflet.html">
            
                <a href="05-Using_geojson_files_in_Leaflet.html">
            
                    
                    Chapter 5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="06-Custom_markers.html">
            
                <a href="06-Custom_markers.html">
            
                    
                    Chapter 6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="07-Creating_an_interactive_choropleth_map.html">
            
                <a href="07-Creating_an_interactive_choropleth_map.html">
            
                    
                    Chapter 7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="08-Creating_controls.html">
            
                <a href="08-Creating_controls.html">
            
                    
                    Chapter 8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="09-Heatmaps.html">
            
                <a href="09-Heatmaps.html">
            
                    
                    Chapter 9
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.11" data-path="10-Clustering_marker_points.html">
            
                <a href="10-Clustering_marker_points.html">
            
                    
                    Chapter 10
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="11-Mobile_friendly_web_apps.html">
            
                <a href="11-Mobile_friendly_web_apps.html">
            
                    
                    Chapter 11
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="12-Web_Map_Services.html">
            
                <a href="12-Web_Map_Services.html">
            
                    
                    Chapter 12
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="13-Standard_website_with_leaflet_project.html">
            
                <a href="13-Standard_website_with_leaflet_project.html">
            
                    
                    Chapter 13
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="14-ESRI_Leaflet.html">
            
                <a href="14-ESRI_Leaflet.html">
            
                    
                    Chapter 14
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Chapter 10</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="cluster-to-reduce-the-clutter">Cluster to reduce the clutter</h1>
<h2 id="a-map-full-of-clutter">A map full of clutter</h2>
<p>There comes a time when it is convenient to coalesce several points into a single multi-cluster point. Consider the following example: you have a GeoJSON file with over 10000 points of houses within a densely populated island of 5km by 5km, if by any chance such a scenario exists. Will you want to display such a gigantic number of points within such a small area? That would be an overkill! Moreover, the map would be incomprehensible to the viewer. Consider the following example we set up in a new JavaScript file which we fondly called <code>cluster-markers.js</code>. </p>
<pre><code>var map = L.map(&apos;myMap&apos;).setView([-1.295287148, 36.81984753], 7);

L.tileLayer(&apos;https://tile.openstreetmap.org/{z}/{x}/{y}.png&apos;, {
    maxZoom: 19,
    attribution: &apos;&amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;&apos;
}).addTo(map);


url = &apos;https://raw.githubusercontent.com/sammigachuhi/geojson_files/main/selected_hospitals.json&apos;

L.geoJson.ajax(url).addTo(map);

var markers = L.markerClusterGroup();
</code></pre><p>The following is the result.</p>
<p><img src="images/clutter-points.jpg" alt=""></p>
<p>Not good at all. The <code>Leaflet.markercluster</code> plugin is what transforms a clutter map into one of neatly arranged clustered marker points.</p>
<h2 id="preparations">Preparations</h2>
<p>Creating a cluster marker map is fairly easy. You will first have to insert the <code>Leaflet.markerCluster</code> plugin into <code>map.html</code>. The plugin is available from <a href="https://github.com/Leaflet/Leaflet.markercluster/archive/refs/heads/master.zip" target="_blank">here</a>. Insert the following <code>&lt;script&gt;</code> tag into the <code>&lt;head&gt;</code> element of your <code>map.html</code>.</p>
<pre><code>&lt;script src=&quot;Leaflet.markercluster-1.4.1\Leaflet.markercluster-1.4.1\dist\leaflet.markercluster.js&quot;&gt;&lt;/script&gt;
</code></pre><p>You will also have to insert the <code>Leaflet.markercluster</code> CSS properties via the <code>&lt;link&gt;</code> tag too. Add the following <code>&lt;link&gt;</code> tag for <code>Leaflet.markercluster</code>. For legibility and clean code, place below the other <code>&lt;link&gt;</code> properties.</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;Leaflet.markercluster-master\Leaflet.markercluster-master\dist\MarkerCluster.Default.css&quot;&gt;
</code></pre><p>Don&apos;t underestimate them. These CSS properties are necessary to style your cluster points in a nice way that&apos;s easy on the eye. It is also assumed you have already inserted the name of your JavaScript file, the <code>cluster-marker.js</code> within the <code>script</code> tag enclosed by the <code>&lt;body&gt;</code> element of your <code>map.html</code> file.</p>
<p>If you had done the small exercise at the beginning of the chapter, the following code should be present.</p>
<pre><code>var map = L.map(&apos;myMap&apos;).setView([-1.295287148, 36.81984753], 7);

L.tileLayer(&apos;https://tile.openstreetmap.org/{z}/{x}/{y}.png&apos;, {
    maxZoom: 19,
    attribution: &apos;&amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;&apos;
}).addTo(map);


url = &apos;https://raw.githubusercontent.com/sammigachuhi/geojson_files/main/selected_hospitals.json&apos;
</code></pre><h2 id="behold-a-cluster-marker-map">Behold, a cluster marker map!</h2>
<p>Delete the <code>L.geoJson.ajax(url).addTo(map);</code>, we won&apos;t need it now. Our real work of creating a cluster marker map begins with the <code>markerClusterGroup</code> class. Let&apos;s proceed!</p>
<pre><code>var markers = L.markerClusterGroup();
</code></pre><p>We shall use Ajax again but this time round we shall parse in some functions to customize the appearance and functionalities of our GeoJson markers.</p>
<pre><code>
L.geoJson.ajax(url, {
    pointToLayer: ((feature, latLng) =&gt; {
        return markers.addLayer(L.circleMarker(latLng));
    }),

    onEachFeature: ((feature, layer) =&gt; {
        layer.bindPopup(`&lt;b&gt;Facility Name:&lt;/b&gt; ${feature.properties.Facility_N} &lt;br&gt;
        &lt;b&gt;Type:&lt;/b&gt; ${feature.properties.Type}`)
    })
}).addTo(map);
</code></pre><p>Remember <code>pointToLayer</code> of Leaflet GeoJSON files? It defines how the GeoJson file will appear. The <code>pointToLayer</code> retrieves the Latitude-Longitude coordinates before finally creating circle markers out of them as enabled by <code>...return markers.addLayer(L.circleMarker(latLng))</code>, </p>
<p>How about for <code>onEachFeature</code>? You can guess. It simply means-- <em>O</em>n <em>E</em>ach <em>F</em>eature, <em>do this and that</em>. In our case we bind a popup of facility name and type which will appear when a circle marker is clicked upon.</p>
<p>Actually, the above code sort of finished the work for us.</p>
<p><img src="images/cluster-marker-map.jpg" alt=""></p>
<p>Zoom in and out and watch the circle markers <em>spidefy</em> the individual points with a popup. I have restrained from tweaking the markers because the defaults are already good enough. See them from this <a href="https://github.com/Leaflet/Leaflet.markercluster" target="_blank">Github Page</a>. </p>
<p>However, as good practice, we need to add the <code>markers</code> global variable to the map. We do so by using the following code.</p>
<pre><code>map.addLayer(markers)
</code></pre><p><code>addLayers</code>, just like the name suggests, adds the given layer to the map.</p>
<p>The <code>L.circleMarker</code> in the <code>pointToLayer</code> key of the Ajax function can be replaced with <code>L.marker()</code>. Below is how some spiderfied hospital markers look like, but they are less aesthetically pleasing than the circle markers. </p>
<p><img src="images/cluster-marker-plain.jpg" alt=""></p>
<p>Coming back full circle, circle markers are way better.</p>
<p>Most of the Ajax code was inspired by this <a href="https://www.youtube.com/watch?v=R-V7XFUbrkw&amp;t=625s" target="_blank">video</a>. </p>
<p>But wait! Hold your horses, there is a bug. Try to click on any of the spiderfied or lone hospitals and you will notice something that will raise eyebrows. All hospitals display the following popup when clicked:</p>
<pre><code>Facility Name: Wajir Tb Manyatta Sub - District Hospital
Type: Sub-District Hospital
</code></pre><p><img src="images/cluster-marker-bug.jpg" alt=""></p>
<p>Unless a developer would like to be left with an egg on the face for assigning the same place names to all hospitals, this should be dealt with expeditiously. Our code is alright, since it works in other scenarios such as <a href="https://gis.stackexchange.com/questions/346104/popup-with-leaflet-markercluster-in-leaflet-map?utm_source=pocket_reader" target="_blank">here</a>. However, it is unnacceptable to assign wrong place names in the world wide web. </p>
<p>Time to try a different strategy: using <code>fetch</code> API. We have worked with <code>fetch</code> before so we will not explain it that much here. Feel free to google about it as a refresher. Comment out the earlier code beginning from <code>var markers</code> to <code>map.addLayer(markers)</code> and replace it with the following code chunk.</p>
<pre><code>fetch(url)
    .then((response) =&gt;{
        return response.json()
    })
    .then((data) =&gt; {
        var markers = L.markerClusterGroup();

        var geojsonGroup = L.geoJSON(data, {
            onEachFeature : function(feature, layer){
                layer.bindPopup(`&lt;b&gt;Facility Name:&lt;/b&gt; ${feature.properties.Facility_N} &lt;br&gt;
                &lt;b&gt;Type:&lt;/b&gt; ${feature.properties.Type}`);
            },
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng);
            }
        });

        markers.addLayer(geojsonGroup);
        map.addLayer(markers);

    })
    .catch((error) =&gt; {
        console.log(`This is the error: ${error}`)
    })
</code></pre><p><img src="images/cluster-marker-map-fixed.jpg" alt=""></p>
<p>Now all points have their rightful and respective names.</p>
<h2 id="additional-features-of-cluster-marker-plugin">Additional features of Cluster marker plugin</h2>
<p>The official documentation of the plugin lists many other features that come along with the tool. We can&apos;t go through all of them but let&apos;s surmise just one important functionality: the <code>mouseover</code> event. A <code>mouseover</code> event triggers an action when a mouse hovers of a feature in Leaflet. </p>
<p>Let&apos;s demonstrate adding a hover event to our cluster marker map, thanks to this <a href="https://gnisitricks.de/2019/03/Adding-Click-and-Mouseover-Events-simultaneously-to-GeoJson-Markers-on-a-Leaflet-Map/" target="_blank">answer</a>.</p>
<pre><code>/////// Added `mouseover` event

fetch(url)
    .then((response) =&gt;{
        return response.json()
    })
    .then((data) =&gt; {
        var markers = L.markerClusterGroup({chunkedLoading: true}); // Splits the add layers to small intervals to prevent page freezing

        var geojsonGroup = L.geoJSON(data, {
            onEachFeature : function(feature, layer){
                layer.bindPopup(`&lt;b&gt;Facility Name:&lt;/b&gt; ${feature.properties.Facility_N} &lt;br&gt;
                &lt;b&gt;Type:&lt;/b&gt; ${feature.properties.Type}`);
            },
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng).on(&apos;mouseover&apos;, function(){
                    this.bindPopup(`Nearest_Center: ${feature.properties.Nearest_To}`).openPopup(); // Add mouseover event
                });
            }
        });

        markers.addLayer(geojsonGroup);
        map.addLayer(markers);

    })
    .catch((error) =&gt; {
        console.log(`This is the error: ${error}`)
    })
</code></pre><p>From the above code, we added the <code>mouseover</code> event to each marker point using the <code>on</code> method. The <code>this</code> keyword in <code>this.bindPopup()</code> ties popups of selected variables to coordinates in the <code>var geojsonGroup</code> variable. We also sped the rendering of our Leaflet map by adding <code>chunkedLoading: true</code> parameter to <code>L.markerCluster()</code> function.</p>
<p>Hovering over each marker point will show a value of the <code>Nearest_To</code> attribute which is an actual town centre in closest proximity to the hospital marker.</p>
<p><img src="images/cluster-marker-mouseover.jpg" alt=""></p>
<p>The code files used for this chapter are available from <a href="https://github.com/sammigachuhi/my-leaflet-project/tree/main/my-leaflet-code/chapter-10-Cluster_marker_points" target="_blank">here</a>.</p>
<h2 id="summary">Summary</h2>
<p>Cluster marker points are a neat way of displaying several points. Upon zooming out, the spatially sparsed points coalesce to a single unit displaying a figure standing for the number of markers it holds. Upon zooming in, the points spiderfy, (think of spreading out) to their appropriate locations. Here are the lessons from this chapter.</p>
<ul>
<li><p>Clustering points is at times useful for map neatness. In Leaflet, this is made possible with the <code>Leaflet.markercluster</code> plugin.</p>
</li>
<li><p>It is possible to customize how the spiderfied marker points will appear. For example, instead of settling for the default styles of individual markers, we used the circle markers to show individual points.</p>
</li>
<li><p>It is also possible to add events to the spiderfied marker points. When clicked, the spiderfied marker points can show a popup, or trigger any other event as specified in its code block. </p>
</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="09-Heatmaps.html" class="navigation navigation-prev " aria-label="Previous page: Chapter 9">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="11-Mobile_friendly_web_apps.html" class="navigation navigation-next " aria-label="Next page: Chapter 11">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Chapter 10","level":"1.11","depth":1,"next":{"title":"Chapter 11","level":"1.12","depth":1,"path":"11-Mobile_friendly_web_apps.md","ref":"11-Mobile_friendly_web_apps.md","articles":[]},"previous":{"title":"Chapter 9","level":"1.10","depth":1,"path":"09-Heatmaps.md","ref":"09-Heatmaps.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"}},"file":{"path":"10-Clustering_marker_points.md","mtime":"2026-01-30T19:33:17.814Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2026-02-01T10:07:22.915Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

