
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Chapter 8 Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="09-Heatmaps.html" />
    
    
    <link rel="prev" href="07-Creating_an_interactive_choropleth_map.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="01-Introduction.html">
            
                <a href="01-Introduction.html">
            
                    
                    Chapter 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="02-First_Leaflet_Map.html">
            
                <a href="02-First_Leaflet_Map.html">
            
                    
                    Chapter 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="03-Add_ons.html">
            
                <a href="03-Add_ons.html">
            
                    
                    Chapter 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="04-Embedding_Leaflet_Map_to_an_External_Website.html">
            
                <a href="04-Embedding_Leaflet_Map_to_an_External_Website.html">
            
                    
                    Chapter 4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="05-Using_geojson_files_in_Leaflet.html">
            
                <a href="05-Using_geojson_files_in_Leaflet.html">
            
                    
                    Chapter 5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="06-Custom_markers.html">
            
                <a href="06-Custom_markers.html">
            
                    
                    Chapter 6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="07-Creating_an_interactive_choropleth_map.html">
            
                <a href="07-Creating_an_interactive_choropleth_map.html">
            
                    
                    Chapter 7
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9" data-path="08-Creating_controls.html">
            
                <a href="08-Creating_controls.html">
            
                    
                    Chapter 8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="09-Heatmaps.html">
            
                <a href="09-Heatmaps.html">
            
                    
                    Chapter 9
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="10-Clustering_marker_points.html">
            
                <a href="10-Clustering_marker_points.html">
            
                    
                    Chapter 10
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="11-Mobile_friendly_web_apps.html">
            
                <a href="11-Mobile_friendly_web_apps.html">
            
                    
                    Chapter 11
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="12-Web_Map_Services.html">
            
                <a href="12-Web_Map_Services.html">
            
                    
                    Chapter 12
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="13-Standard_website_with_leaflet_project.html">
            
                <a href="13-Standard_website_with_leaflet_project.html">
            
                    
                    Chapter 13
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="14-ESRI_Leaflet.html">
            
                <a href="14-ESRI_Leaflet.html">
            
                    
                    Chapter 14
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Chapter 8</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="layer-groups-and-controls">Layer groups and controls</h1>
<h2 id="purpose-of-layer-groups-and-controls">Purpose of layer groups and controls</h2>
<p>Sometimes, one may wish for their webmap to consist of several baselayers or overlay maps. Suppose you want your Leaflet to have two basemap layers, and an additional overlay with the option of switching to any of them, how would you proceed? </p>
<h2 id="set-up-the-basemaps">Set up the basemaps</h2>
<p>In order to create controls, we have to parse the objects holding our map variables into a <code>L.control.layers</code> class. Thereafter, the <code>L.controls.layers</code> class is used to parse the object values to the Leaflet map and create a UI control. To demonstrate this, open a new JavaScript file and name it <code>groups_controls.js</code>. Insert the following code which will save our basemaps to the respective variables of <code>osm</code> and <code>cyclOSM</code>. </p>
<pre><code>var osm = L.tileLayer(&apos;https://tile.openstreetmap.org/{z}/{x}/{y}.png&apos;, {
    maxZoom: 19,
    attribution: &apos;&amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;&apos;
});

var cyclOSM = L.tileLayer(&apos;https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png&apos;, {
    maxZoom: 20,
    attribution: &apos;&lt;a href=&quot;https://github.com/cyclosm/cyclosm-cartocss-style/releases&quot; title=&quot;CyclOSM - Open Bicycle render&quot;&gt;CyclOSM&lt;/a&gt; | Map data: &amp;copy; &lt;a href=&quot;https://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&apos;
}); // the CyclOSM tile layer available from Leaflet servers
</code></pre><p>We will pass the above two variables of <code>osm</code> and <code>cyclOSM</code> to the <code>L.map</code> class which has an option of <code>layers</code> in which one can parse the layers they wish to be displayed on the map.</p>
<pre><code>var map = L.map(&apos;myMap&apos;, {
    layers: [osm, cyclOSM]
}).setView([-1.295287148, 36.81984753], 7);
</code></pre><p>However, that will only add the first basemap variable --that for <code>osm</code> while blocking out that of <code>cylcOSM</code>. This is shown below.</p>
<p><img src="images/no-control.jpg" alt=""></p>
<h2 id="creating-the-controls">Creating the controls</h2>
<p>However, in order to give <code>cyclOSM</code> a fair chance, we need to store them in an object say <code>var basemaps</code> and parse it to <code>L.controls.layer</code> which shall create a checkbutton for each basemap. The below code does just that.</p>
<pre><code>// Set object for the basemaps
var basemaps = {
    &quot;OpenStreetMap&quot;: osm,
    &apos;cycleOsm&apos;: cyclOSM,
}

L.control.layers(basemaps).addTo(map);
</code></pre><p>This is the result you get.</p>
<p><img src="images/controls.jpg" alt=""></p>
<h2 id="adding-overlay-maps">Adding overlay maps</h2>
<p>Now we have seen how to add two or more basemaps to Leaflet and make all of them appear in the layer control. Adding an overlay map follows the same procedure as well. </p>
<p>The first overlay we would like to create is a choropleth map displaying the percentage of conventional households with access to main sewers as per the <a href="https://housingfinanceafrica.org/app/uploads/VOLUME-IV-KPHC-2019.pdf" target="_blank">2019 census</a>. For simplicity purposes and to bypass errors we faced, we shall reuse the Ajax plugin for fetching GeoJSON files from online servers. As a reminder, we load Ajax into Leaflet by inserting it to the following <code>&lt;script&gt;</code> tags of our <code>map.html</code>.</p>
<pre><code>&lt;script src=&quot;leaflet-ajax-gh-pages\dist\leaflet.ajax.js&quot;&gt;&lt;/script&gt;

&lt;script src=&quot;leaflet-ajax-gh-pages\dist\leaflet.ajax.min.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;leaflet-ajax-gh-pages\example\leaflet.spin.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;leaflet-ajax-gh-pages\example\spin.js&quot;&gt;&lt;/script&gt;
</code></pre><p>Using <code>fetch</code> API to load the json file brought up several errors requiring out-of-the-box thinking to solve, but using the alternative Ajax plugin was a safe landing. The following chunks of code will add the color function and styling for our countrywide sanitation map. The resulting coloring function shall be parsed to the Ajax function.</p>
<pre><code>//// Adding some color
function getColor(d) {
    return d &gt; 20 ? &apos;#3288bd&apos; :
            d &gt; 10 ? &apos;#99d594&apos; :
            d &gt; 6 ? &apos;#e6f598&apos; :
            d &gt; 4 ? &apos;#fee08b&apos; :
            d &gt;  2 ? &apos;#fc8d59&apos;:
                     &apos;#d53e4f&apos;;

}

// Function for setting color (using arrow function)
var style = ((feature)=&gt; {
    return {
        fillColor: getColor(feature.properties.Human_waste_disposal),
        weight: 2,
        opacity: 1,
        color: &apos;gray&apos;,
        fillOpacity: 0.9
    }
})
</code></pre><p>Now let&apos;s add the overlay map that will display the population&apos;s accessibility to main sewer sanitation services. Spoiler alert: the statistics are quite grim.</p>
<pre><code>// Adding the first overlay - map of household access to main sewer
var countySanitation = new L.geoJson.ajax(&quot;https://raw.githubusercontent.com/sammigachuhi/geojson_files/main/counties_sanitation.json&quot;, {
    style: style
})
.bindPopup(function (layer) {
            return `&lt;b&gt;County Name: &lt;/b&gt; ${layer.feature.properties.ADM1_EN} &lt;br&gt;
            &lt;b&gt;Total County Population: &lt;/b&gt;&lt;br&gt; 
            ${layer.feature.properties.County_pop.toString()} &lt;br&gt;&lt;br&gt;
            &lt;b&gt;% of Conventional Households with access to main sewer: &lt;/b&gt;&lt;br&gt;&lt;br&gt;
            ${layer.feature.properties.Human_waste_disposal.toString()}`
        }).addTo(map);
</code></pre><p>Let&apos;s add an accompanying legend for the above map. If you worked through [Chapter 7][Creating an interactive choropleth map] that dealt with interactive choropleths, some of the below code should look familiar.</p>
<pre><code>
// Create a legend
var legend = L.control({position: &apos;bottomright&apos;});

legend.onAdd = function (map) {
    var div = L.DomUtil.create(&apos;div&apos;, &apos;info legend&apos;),
    grades = [0, 2, 4, 6, 10, 20],
    labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i &lt; grades.length; i++) {
        div.innerHTML += 
            &apos;&lt;i style=&quot;background:&apos; + getColor(grades[i] + 1) + &apos;&quot;&gt;&lt;/i&gt; &apos; + 
            grades[i] + (grades[i + 1] ? &apos;&amp;ndash;&apos; + grades[i + 1] + &apos;&lt;br&gt;&apos; : &apos;+&apos;);
    }
    return div;
}

legend.addTo(map);
</code></pre><p>Now set an object to hold one of our two overlay maps. </p>
<pre><code>var overlays = {
    &apos;countySanitation&apos;: countySanitation,
}
</code></pre><p>Finally parse the <code>overlays</code> object to the <code>L.controls.layer</code> class.</p>
<pre><code>// Add layer controls
L.control.layers(basemaps, overlays).addTo(map);
</code></pre><p><img src="images/controls-overlay.jpg" alt=""></p>
<p>If you click in any one of the counties, you will see popups appear.</p>
<p>There is one more overlay we will add to our display to bring our experimentation with layer controls back full circle. Remember the GeoJSON of our <code>cities</code> variable? Let&apos;s call it back to action. But first let&apos;s load the custom icon markers that differentiate our cities based on population. </p>
<pre><code>// Color icons
// Yellow Icon
var yellowIcon = new L.Icon({
    iconUrl: &apos;https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png&apos;,
    shadowUrl: &apos;https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png&apos;,
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

// Orange Icon
var orangeIcon = new L.Icon({
    iconUrl: &apos;https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png&apos;,
    shadowUrl: &apos;https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png&apos;,
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

// Red Icon
var redIcon = new L.Icon({
    iconUrl: &apos;https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png&apos;,
    shadowUrl: &apos;https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png&apos;,
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });
</code></pre><p>Let&apos;s load the <code>cities</code> GeoJSON with its icons.</p>
<pre><code>var cities = L.geoJson.ajax(&quot;https://raw.githubusercontent.com/sammigachuhi/geojson_files/main/cities-geojson2.geojson.txt&quot;, {
    pointToLayer: function (feature, latlng) {
            if (feature.properties.Population &lt;= 250000) {
              return L.marker(latlng, {
                icon: yellowIcon 
              });
            } else if (feature.properties.Population &lt;= 800000) {
              return L.marker(latlng, {
                icon: orangeIcon 
              });
            } else {
              return L.marker(latlng, {
                icon: redIcon 
              });
            }

          }
}).bindPopup(function (layer) {
      return `City: ${layer.feature.properties.City},&lt;br&gt;
      Population: ${layer.feature.properties.Population}`;
    }).addTo(map);
</code></pre><p>Add the <code>cities</code> variable as one of the keys to our <code>overlays</code> variable and finally parse the <code>overlays</code> object to <code>L.control.layers</code>.</p>
<pre><code>// Set object for the overlay maps
var overlays = {
    &apos;countySanitation&apos;: countySanitation,
    &apos;cities&apos;: cities
}

// Add layer controls
L.control.layers(basemaps, overlays).addTo(map);
</code></pre><p>In the [chapter 7][Creating an interactive choropleth map], we ended by saying that we strive to make our choropleths map challenge rather than merely inform. This looks like a sketchy map, but it clearly shows the discrepancy of access to basic sanitation services in a large portion of the population. </p>
<p>Finally, it seems changing the position of the <code>L.controls.layer</code> from its default top-right position is impossible. For example, setting the position to left, in the <code>L.controls.layer(basemap, overlaymap, {position: &apos;topleft&apos;})</code> results in the UI layers control disappearing completely off the map. This may likely be a yet to be reported bug.</p>
<p><img src="images/controls-all.jpg" alt=""></p>
<h2 id="add-a-scale-bar">Add a scale bar</h2>
<p>Scales are one of the key elements of any map. One may wonder what&apos;s their use in a webmap, but they are useful in estimating size and length of features. Adding a small reactive scale will not hurt!</p>
<pre><code>// Add scale
L.control.scale({position:&apos;bottomleft&apos;}).addTo(map);
</code></pre><p><img src="images/controls-scale.jpg" alt=""></p>
<p>All the files and scripts used in this chapter can be accessed <a href="https://github.com/sammigachuhi/my-leaflet-project/tree/main/my-leaflet-code/chapter-8-layer_groups_and_controls" target="_blank">here</a>.</p>
<h2 id="summary">Summary</h2>
<p>Unlike paper maps, webmaps provide us the ability to include several basemaps and overlays all in one platform. Here&apos;s is what you have learnt from this chapter.</p>
<ul>
<li><p>Several basemaps and overlays can be parsed into Leaflet by holding the basemap and overlay variable names in a JavaScript dictionary object.</p>
</li>
<li><p>To create a layers control, parse the JavaScript object containing the basemap and overlay names to the <code>L.control.layers()</code> class.</p>
</li>
<li><p>GeoJSON features can also be parsed to the layer control. All that is needed is to save the function calling the GeoJSON file into a variable. For example, the Ajax function <code>var cities</code> was parsed to the <code>L.control.layers()</code> class.</p>
</li>
<li><p>Scales are useful for size and length estimation, even in webmaps. Leaflet provides the <code>L.control.scale</code> class to add custom scales to your webmap.</p>
</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="07-Creating_an_interactive_choropleth_map.html" class="navigation navigation-prev " aria-label="Previous page: Chapter 7">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="09-Heatmaps.html" class="navigation navigation-next " aria-label="Next page: Chapter 9">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Chapter 8","level":"1.9","depth":1,"next":{"title":"Chapter 9","level":"1.10","depth":1,"path":"09-Heatmaps.md","ref":"09-Heatmaps.md","articles":[]},"previous":{"title":"Chapter 7","level":"1.8","depth":1,"path":"07-Creating_an_interactive_choropleth_map.md","ref":"07-Creating_an_interactive_choropleth_map.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"}},"file":{"path":"08-Creating_controls.md","mtime":"2026-01-30T19:32:12.350Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2026-02-01T10:07:22.915Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

